<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8">
  <link rel="Website Icon" type="png" href="/public/logo_pnp.png">
  <title> Manager List </title>
  <link rel="stylesheet" href="/stylesheets/index_style.css">
  <!-- Boxicons CDN Link -->
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- For Xlsx Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>



  <script src="https://unpkg.com/@mongodb-js/charts-embed-dom"></script>

</head>

<body>
  <div class="sidebar">
    <div class="logo-details">
      <img src="/pnp-male.jpg" alt="" class="circle-image">
      <span class="logo_name">Admin</span>
    </div>
    <ul class="nav-links">
      <li>
        <a href="/index" id="home-link" class="active">
          <i class='bx bx-grid-alt'></i>
          <span class="links_name">Dashboard</span>
        </a>
      </li>
      <li>
        <a id="datatable-link" href="/DataTable">
          <i class='bx bx-table'></i>
          <span class="links_name">Records</span>
        </a>
      </li>
      <li>
        <a id="scanner-link" href="/scanner">
          <i class='bx bx-scan'></i>
          <span class="links_name">Scanner</span>
        </a>
      </li>
      <li>
        <a id="admin-table-link" href="/admin/table">
          <i class='bx bx-user'></i>
          <span class="links_name">Manager</span>
        </a>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-book'></i>
          <span class="links_name">Help</span>
        </a>
      </li>

      <li class="log_out">
        <a id="logout-link" href="/logout">
          <i class='bx bx-log-out'></i>
          <span class="links_name">Log out</span>
        </a>
      </li>
    </ul>
  </div>
  <section class="home-section">
    <nav>
      <div class="sidebar-button">
        <i class='bx bx-menu sidebarBtn'></i>
        <span class="dashboard">Manager List</span>
      </div>

    </nav>

    <div class="home-content">
      <div class="main-boxes">
        <div class="right-boxes box" style="width: 100%; height: auto;">

          <form action="/admin/table" method="GET" onsubmit="handleFilterSubmit(event)" class="custom-form">
            <div class="custom-dropdown">
              <button type="button" class="custom-dropdown-toggle">
                Rank<i class='bx bx-chevron-down'></i>
              </button>
              <ul class="custom-dropdown-menu scrollable-menu">
                <% checkbRanks.forEach(function(CBrank) { %>
                  <li class="custom-dropdown-item">
                    <div class="custom-form-check">
                      <input type="checkbox" id="<%- CBrank %>" class="custom-form-check-input" name="rank"
                        value="<%- CBrank %>" <% if (CBranks.includes(CBrank)) { %>checked<% } %>>
                        <label class="custom-form-check-label" for="<%- CBrank %>"><%- CBrank %></label>
                    </div>
                  </li>
                  <% }); %>
              </ul>
            </div>

            <div class="custom-dropdown">
              <button type="button" class="custom-dropdown-toggle">
                Station<i class='bx bx-chevron-down'></i>
              </button>
              <ul class="custom-dropdown-menu scrollable-menu">
                <% checkbStations.forEach(function(CBstation) { %>
                  <li class="custom-dropdown-item">
                    <div class="custom-form-check">
                      <input class="custom-form-check-input" type="checkbox" id="<%- CBstation %>" name="station"
                        value="<%- CBstation %>" <% if (CBstations.includes(CBstation)) { %>checked<% } %>>
                        <label class="custom-form-check-label" for="<%- CBstation %>"> <%- CBstation %> </label>
                    </div>
                  </li>
                  <% }); %>
              </ul>
            </div>

            <button type="submit" class="custom-button primary">Filter<i class='bx bx-filter-alt'></i></button>
            <button type="reset" class="custom-button secondary">Reset<i class='bx bx-reset'></i></button>
          </form>

          <!-- Search bar -->
          <form action="/admin/table" method="GET" onsubmit="handleFilterSubmit(event)" class="custom-search-form">
            <div class="custom-form-row">
              <div class="custom-form-group col">
                <input type="text" class="search-input" id="searchQuery" name="search" list="searchSuggestions"
                  placeholder="Enter name or gun name" <% if (searchQuery) { %>value="<%- searchQuery %>"<% } %>>
                    <datalist id="searchSuggestions">
                      <% suggestions.forEach(function(suggestion) { %>
                        <option value="<%- suggestion %>">
                          <% }); %>
                    </datalist>
              </div>
              <button type="submit" class="custom-button primary">Search<i class='bx bx-search-alt-2'></i></button>
            </div>

          </form>


          <% if (typeof ErrorMessage !=='undefined' ) { %>
            <p style="color: red;">
              <%= ErrorMessage %>
            </p>
            <% } else if (typeof SuccessMessage !=='undefined' ) { %>
              <p style="color: green;">
                <%= SuccessMessage %>
              </p>
              <% } %>


                <table class="custom-table">
                  <thead class="custom-table-header">
                    <tr>
                      <th>#</th>
                      <th>Full Name</th>
                      <th>Rank</th>
                      <th>Police ID</th>
                      <th>Station</th>
                      <th>Actions</th>
                    </tr>
                  </thead>

                  <tbody>
                    <% if (datas.length> 0) { %>
                      <% let counter=(page - 1) * limit + 1; %>
                        <% datas.forEach(function (data) { %>
                          <tr>
                            <td>
                              <%= counter %>
                            </td>
                            <td>
                              <%= data.lastName %>, <%= data.firstName %>
                                  <%= data.middleName %>
                                    <%= data.QLFR %>
                            </td>
                            <td>
                              <%= data.rank %>
                            </td>
                            <td>
                              <%= data.policeId %>
                            </td>
                            <td>
                              <%= data.station %>
                            </td>

                            <td>


                              <div class="custom-button-group-manager">
                                <button class="custom-button2" data-id="<%= data.id %>" id="myBtn">
                                  <i class='bx bx-low-vision'></i>
                                </button>


                                <button class="custom-button2" id="myBtn2">
                                  <i class='bx bx-edit'></i>
                                </button>


                                <button class="custom-button2 custom-button-danger"
                                  onclick="confirmDelete('<%= data.id %>')">
                                  <i class='bx bx-trash'></i>
                                </button>
                              </div>
                            </td>

                          </tr>
                          <% counter++; %>
                            <% }); %>
                              <% } else { %>
                                <tr>
                                  <td colspan="10" class="text-center">No data found.</td>
                                </tr>
                                <% } %>
                  </tbody>
                </table>

                <!-- Pagination -->
                <div class="custom-pagination mt-5">
                  <div class="custom-pagination-info">
                    <span class="custom-pagination-text">Showing <%= (page - 1) * limit + 1 %>-<%= Math.min(page *
                          limit, totalRecords) %> of <%= totalRecords %></span>
                  </div>
                  <div class="custom-pagination-buttons">

                    <% if (page> 1) { %>
                      <a href="/admin/table?page=<%= page - 1 %>" class="custom-button2 custom-button-primary"><i
                          class='bx bx-skip-previous'></i></a>
                      <% } %>
                        <% for (let i=1; i <=totalPages; i++) { %>
                          <% if (page===i) { %>
                            <span class="custom-button2 custom-button-secondary">
                              <%= i %>
                            </span>
                            <% } else { %>
                              <a href="/admin/table?page=<%= i %>" class="custom-button2 custom-button-primary">
                                <%= i %>
                              </a>
                              <% } %>
                                <% } %>
                                  <% if (page < totalPages) { %>
                                    <a href="/admin/table?page=<%= page + 1 %>"
                                      class="custom-button2 custom-button-primary"><i class='bx bx-skip-next'></i></a>
                                    <% } %>

                  </div>
                </div>



                <!-- The Modal -->
                <div id="myModal" class="modal">

                  <!-- Modal content -->
                  <div class="modal-content">
                    <span class="close">&times;</span>
                    <h1 class="text-center">View Record</h1>

                    <table class="table table-hover">
                      <tbody>
                        <tr>
                          <td><strong>Last Name</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>First Name</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Middle Name</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Qualifier</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Rank</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Station</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Gun Type</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Gun Name</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Caliber</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Serial Number</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Cost</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Acquisition Date</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Turn Over</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Returned</strong></td>
                          <td>

                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>


                <!-- My Modal 2 -->

                <div id="myModal2" class="modal">

                  <!-- Modal content -->
                  <div class="modal-content">
                    <span class="close2">&times;</span>
                    <h1 class="text-center">Edit Record</h1>

                    <table class="table table-hover">
                      <tbody>
                        <tr>
                          <td><strong>Last Name</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>First Name</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Middle Name</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Qualifier</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Rank</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Station</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Gun Type</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Gun Name</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Caliber</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Serial Number</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Cost</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Acquisition Date</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Turn Over</strong></td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td><strong>Returned</strong></td>
                          <td>

                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

        </div>

      </div>


    </div>


    </div>



  </section>

  <script>
    let sidebar = document.querySelector(".sidebar");
    let sidebarBtn = document.querySelector(".sidebarBtn");
    sidebarBtn.onclick = function () {
      sidebar.classList.toggle("active");
      if (sidebar.classList.contains("active")) {
        sidebarBtn.classList.replace("bx-menu", "bx-menu-alt-right");
      } else
        sidebarBtn.classList.replace("bx-menu-alt-right", "bx-menu");
    }
  </script>


  <script>
    document.addEventListener("click", function (event) {
      closeDropdowns(event.target);
    });

    function closeDropdowns(currentButton) {
      var buttons = document.querySelectorAll(".custom-dropdown button");
      buttons.forEach(function (button) {
        var dropdown = button.nextElementSibling;
        if (button !== currentButton) {
          dropdown.style.display = "none";
        }
      });
    }

    var dropdownToggles = document.querySelectorAll('.custom-dropdown-toggle');

    dropdownToggles.forEach(function (toggle) {
      toggle.addEventListener('click', function (event) {
        var dropdown = toggle.nextElementSibling;
        closeDropdowns(toggle);
        dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        event.stopPropagation();
      });
    });

    // Add an event listener to handle checkbox selections
    var checkboxes = document.querySelectorAll('.custom-dropdown .custom-form-check-input');

    checkboxes.forEach(function (checkbox) {
      checkbox.addEventListener('click', function (event) {
        event.stopPropagation(); // Prevent the dropdown from closing on checkbox click
      });
    });
  </script>



  <script>
    // Get the modals
    var modal = document.getElementById("myModal");
    var modal2 = document.getElementById("myModal2");

    // Get the buttons that open the modals
    var btn = document.getElementById("myBtn");
    var btn2 = document.getElementById("myBtn2");

    // Get the <span> elements that close the modals
    var span = document.getElementsByClassName("close")[0];
    var span2 = document.getElementsByClassName("close2")[0];

    // When the user clicks on the button, open the modal
    btn.onclick = function () {
      modal.style.display = "block";
    };

    btn2.onclick = function () {
      modal2.style.display = "block";
    };

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      modal.style.display = "none";
    };

    span2.onclick = function () {
      modal2.style.display = "none";
    };

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      } else if (event.target == modal2) {
        modal2.style.display = "none";
      }
    };


    // Function to confirm the Delete
    function confirmDelete(id) {
      if (confirm("Are you sure you want to delete this data?")) {
        // If the user confirms, submit the form for deletion
        const form = document.createElement('form');
        form.action = '/delete/' + id;
        form.method = 'POST';
        document.body.appendChild(form);
        form.submit();
      }
    }
  </script>




</body>

</html>