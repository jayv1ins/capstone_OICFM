<header>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <%- include('../../components/navbar') %>




    <style>
      table tr td {
        vertical-align: middle;

      }

      a,
      td button {
        margin: 5px;

      }

      td button i {
        font-size: 20px;
      }

      section {
        padding: 0 150px;
      }
    </style>
</header>
<center>

  <form action="/admin/table" method="GET" onsubmit="handleFilterSubmit(event)">
    <label for="searchQuery">Search:</label>
    <input type="text" id="searchQuery" name="search" list="searchSuggestions" placeholder="Enter name" <% if
      (searchQuery) { %>value="<%- searchQuery %>"<% } %>>
        <datalist id="searchSuggestions">
          <% suggestions.forEach(function(suggestion) { %>
            <option value="<%- suggestion %>">
              <% }); %>
        </datalist>
  </form>


  <form action="/admin/table" method="GET" onsubmit="handleFilterSubmit(event)">
    <h1>Rank</h1>
    <div>
      <% checkbRanks.forEach(function(CBrank) { %>
        <input type="checkbox" id="<%- CBrank %>" name="rank" value="<%- CBrank %>" <% if (CBranks.includes(CBrank)) {
          %>checked<% } %>>
          <label for="<% CBrank %>"> <%- CBrank %> </label><br>
          <% }); %>
    </div>

    <h1>Station</h1>
    <div>
      <% checkbStations.forEach(function(CBstation) { %>
        <input type="checkbox" id="<%- CBstation %>" name="station" value="<%- CBstation %>" <% if
          (CBstations.includes(CBstation)) { %>checked<% } %>>
          <label for="<% CBstation %>"> <%- CBstation %> </label><br>
          <% }); %>
    </div>



    <button type="submit">Filter</button>
    <button type="reset">Reset</button>
  </form>

</center>

<body>
  <% if (typeof ErrorMessage !=='undefined' ) { %>
    <p style="color: red;">
      <%= ErrorMessage %>
    </p>
    <% } else if (typeof SuccessMessage !=='undefined' ) { %>
      <p style="color: green;">
        <%= SuccessMessage %>
      </p>
      <% } %>
     
        <section>
          <div class="mt-5">
            <a class="btn btn-primary" href="/admin/create" role="button">Create New Managers</a>
          </div>
          <div class="row">
            <div class="col-12">
              
              <table class="table table-striped mt-3 text-center table-bordered table-hover">
                <thead class="table-dark">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Full Name</th>
                    <th scope="col">Rank</th>
                    <th scope="col">Police ID</th>
                    <th scope="col">Station</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (datas.length> 0) { %>
                    <% let counter=(page - 1) * limit + 1; %>
                      <% datas.forEach(function(data) { %>
                        <tr>
                          <td>
                            <%= counter %>
                          </td>
                          <td>
                            <%= data.lastName %>, <%= data.firstName %>
                                <%= data.middleName %>
                                  <%= data.QLFR %>
                          </td>
                          <td>
                            <%= data.rank %>
                          </td>
                          <td>
                            <%= data.policeId %>
                          </td>
                          <td>
                            <%= data.station %>
                          </td>
                          <td>
                            <a href="/admin/select/<%= data.id %>"><button class="btn btn-success"><i
                                  class="bi bi-eye"></i></button></a>
                            <a href="/admin/edit/<%= data.id %>"><button class="btn btn-primary"><i
                                  class="bi bi-pencil-square"></i></button></a>
                            <button class="btn btn-danger" onclick="confirmDelete('<%= data.id %>')"><i
                                class="bi bi-trash"></i></button>

                          </td>
                        </tr>
                        <% counter++; %>
                          <% }); %>
                            <% } else { %>
                              <tr>
                                <td colspan="6" class="text-center">No data found.</td>
                              </tr>
                              <% } %>
                </tbody>

              </table>

              <div class="d-flex justify-content-between align-items-center mt-5 mb-5">
                <div>
                  <span class="text-sm text-gray-700">
                    Showing <%= (page - 1) * limit + 1 %>-<%= Math.min(page * limit, totalRecords) %> of <%=
                          totalRecords %>
                  </span>
                </div>
                <div>
                  <nav class="d-inline-flex">
                    <% if (page> 1) { %>
                      <a href="/admin/table?page=<%= page - 1 %>" class="btn btn-primary">
                        Previous
                      </a>
                      <% } %>
                        <% for (let i=1; i <=totalPages; i++) { %>
                          <% if (page===i) { %>
                            <span class="btn btn-secondary">
                              <%= i %>
                            </span>
                            <% } else { %>
                              <a href="/admin/table?page=<%= i %>" class="btn btn-primary">
                                <%= i %>
                              </a>
                              <% } %>
                                <% } %>
                                  <% if (page < totalPages) { %>
                                    <a href="/admin/table?page=<%= page + 1 %>>" class="btn btn-primary">
                                      Next
                                    </a>
                                    <% } %>
                  </nav>
                </div>
              </div>

             
            </div>
          </div>
        </section>


</body>

<script>
  function confirmDelete(id) {
    if (confirm("Are you sure you want to delete this item?")) {
      // If the user confirms, submit the form for deletion
      const form = document.createElement('form');
      form.action = `/admin/delete/${id}`;
      form.method = 'POST';
      document.body.appendChild(form);
      form.submit();
    }
  }
</script>