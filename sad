const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

async function fetchData() {
  try {
    const existingData = await prisma.data.findFirst({
      where: { serialN: '1234' },
    });

    if (existingData) {
      // Get the current date
      const currentDate = new Date();

      // Extract year, month, and day from the current date
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth() + 1; // Month is zero-indexed
      const day = currentDate.getDate();

      // Create a date string in 'YYYY-MM-DD' format
      const formattedDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;

      // Create a new date for the next day
      const nextDay = new Date(currentDate);
      nextDay.setDate(currentDate.getDate() + 1);

      // Extract year, month, and day from the next day's date
      const nextYear = nextDay.getFullYear();
      const nextMonth = nextDay.getMonth() + 1;
      const nextDayOfMonth = nextDay.getDate();

      // Create a date string in 'YYYY-MM-DD' format for the next day
      const formattedNextDay = `${nextYear}-${nextMonth.toString().padStart(2, '0')}-${nextDayOfMonth.toString().padStart(2, '0')}`;

      // Update the data in the database using Prisma's automatic handling of _id
      const updatedData = await prisma.data.update({
        where: { id: existingData.id },
        data: {
          turnOver: formattedDate,
          returned: formattedNextDay, // Set the date for the next day
        },
      });

      console.log(updatedData);
      console.log('the existingData', existingData);
    } else {
      console.log('No data found for serialN: 1234');
    }
  } catch (error) {
    console.error('Error fetching data:', error);
  } finally {
    await prisma.$disconnect();
  }
}

fetchData();
